import pandas as pd

trains = {
    "701": {"маршрут": "Київ – Харків", "прибуття": (10, 15), "відправлення": (10, 30)},
    "112": {"маршрут": "Львів – Полтава", "прибуття": (9, 40), "відправлення": (9, 55)},
    "350": {"маршрут": "Одеса – Суми", "прибуття": (12, 5), "відправлення": (12, 20)},
    "90": {"маршрут": "Харків – Київ", "прибуття": (14, 0), "відправлення": (14, 10)},
    "45": {"маршрут": "Дніпро – Львів", "прибуття": (8, 30), "відправлення": (8, 50)},
    "801": {"маршрут": "Запоріжжя – Київ", "прибуття": (16, 25), "відправлення": (16, 45)},
    "703": {"маршрут": "Київ – Кривий Ріг", "прибуття": (17, 0), "відправлення": (17, 15)},
    "17": {"маршрут": "Чернігів – Одеса", "прибуття": (19, 50), "відправлення": (20, 5)},
    "55": {"маршрут": "Київ – Ужгород", "прибуття": (6, 10), "відправлення": (6, 25)},
    "14": {"маршрут": "Харків – Львів", "прибуття": (21, 30), "відправлення": (21, 45)}
}

data = []

for number, info in trains.items():
    route = info["маршрут"]

    ah, am = info["прибуття"]
    dh, dm = info["відправлення"]

    arr_minutes = ah * 60 + am
    dep_minutes = dh * 60 + dm

    arr_time_str = f"{ah:02d}:{am:02d}"
    dep_time_str = f"{dh:02d}:{dm:02d}"

    stop_time = dep_minutes - arr_minutes

    data.append([
        number,
        route,
        arr_time_str,
        dep_time_str,
        arr_minutes,
        stop_time
    ])

df = pd.DataFrame(data, columns=[
    "Номер поїзда",
    "Маршрут",
    "Час прибуття",
    "Час відправлення",
    "_Службовий_час_для_обчислень",
    "Час стоянки (хв)"
])

# --------------------- ВИВІД ---------------------

print("\nDataFrame з поїздів:")
print(df[["Номер поїзда", "Маршрут", "Час прибуття", "Час відправлення", "Час стоянки (хв)"]].to_string())


print("\nПерші 3 рядки:")
print(df[["Номер поїзда", "Маршрут", "Час прибуття", "Час відправлення", "Час стоянки (хв)"]].head(3).to_string())


print("\nТипи даних:")
print(df.dtypes)


print("\nКількість рядків і стовпців:")
print(df.shape)


print("\nОписова статистика:")
print(df.describe())

# --------------------- ФІЛЬТРАЦІЯ ---------------------

kyiv_trains = df[df["Маршрут"].str.contains("Київ")]

print("\nПоїзди з маршрутом через Київ:")
print(kyiv_trains[["Номер поїзда", "Маршрут", "Час прибуття", "Час відправлення", "Час стоянки (хв)"]].to_string())


# --------------------- СОРТУВАННЯ ---------------------

sorted_df = df.sort_values(by="_Службовий_час_для_обчислень", ascending=True)

print("\nВідсортовано за часом прибуття:")
print(sorted_df[["Номер поїзда", "Маршрут", "Час прибуття", "Час відправлення", "Час стоянки (хв)"]].to_string())


# --------------------- ГРУПУВАННЯ ---------------------

df["Місто відправлення"] = df["Маршрут"].apply(lambda x: x.split(" – ")[0])

grouped = df.groupby("Місто відправлення")["Час стоянки (хв)"].mean()

print("\nСередній час стоянки по містах:")
print(grouped)


# --------------------- АГРЕГАЦІЯ ---------------------

max_city = df["Місто відправлення"].value_counts().idxmax()

print("\nМісто з найбільшою кількістю поїздів:", max_city)

